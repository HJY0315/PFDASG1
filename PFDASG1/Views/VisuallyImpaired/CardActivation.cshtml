@model PFDASG1.Models.CreditCard
@using Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    Layout = null;
    int userid = 0;
    var session = HttpContextAccessor.HttpContext;

    if (session != null)
    {
        userid = session.Session.GetInt32("id") ?? 0;

        if (userid > 0)
        {
            // User is logged in, load the appropriate navbar
            <partial name="_navbar" />
        }
        else
        {
            // User is not logged in, load an alternate navbar or handle the scenario
             <partial name="Navbar" />
        }
    }
    else
    {
        <partial name="Navbar" />
    }

}


<!DOCTYPE html>
<html>
<head>
    <!-- Use Unicode character encoding - multi-language compatibility -->
    <meta charset="utf-8">

    <!-- Set the initial view zooming scale for mobile device -->
    <meta name="viewport" content="width = device-width,
 initial-scale = 1" />

    <title>OCBC</title>

    <!-- Reference to customized styling for this website -->
    @*<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />*@
    <link rel="stylesheet" type="text/css" href="~/css/setting.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- Bootstrap JavaScript (Popper.js is required for dropdowns) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.6.0/annyang.min.js"></script>

</head>

<body>
  
    @if (ViewData["ShowSQSetUp"] == null)
        {  
            <form class="form" autocomplete="off" novalidate>
            <div id="security-questions-container">
            <!-- Initial security question fieldset -->
            <fieldset class="security-question-fieldset">
                <div class="security-question-inputs">
                        <label for="security-questions">Security Questions</label>
                <div class="select">
                    
                    <select class="security-question-dropdown" id="select">
                        <option>Questions</option>
                        <option value="1">Where is your primary school?</option>
                        <option value="2">Who is your best friend?</option>
                        <option value="3">Do you have any musical background?</option>
                    </select>
                </div>
                <input type="text" class="security-question" maxlength="20" style="margin-top:10px; border: none; display:none;" placeholder="Questions" required />
                <input type="text" class="security-answer" maxlength="20" style="margin-top:10px; border: none;" placeholder="Answer" required />
                </div>
            </fieldset>

            <button type="submit" class="btn-add-question">Submit</button>
            </div>
            </form>
      
    }


    else{
    
    <div class="checkout">
        <div class="credit-card-box">
            <div class="flip">
                <div class="front">
                    <div class="chip"></div>
                    <div class="logo">
                        <svg version="1.1" id="visa" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                             width="47.834px" height="47.834px" viewBox="0 0 47.834 47.834" style="enable-background:new 0 0 47.834 47.834;">
                            <g>
                                <g>
                                    <path d="M44.688,16.814h-3.004c-0.933,0-1.627,0.254-2.037,1.184l-5.773,13.074h4.083c0,0,0.666-1.758,0.817-2.143
                           c0.447,0,4.414,0.006,4.979,0.006c0.116,0.498,0.474,2.137,0.474,2.137h3.607L44.688,16.814z M39.893,26.01
                           c0.32-0.819,1.549-3.987,1.549-3.987c-0.021,0.039,0.317-0.825,0.518-1.362l0.262,1.23c0,0,0.745,3.406,0.901,4.119H39.893z
                           M34.146,26.404c-0.028,2.963-2.684,4.875-6.771,4.875c-1.743-0.018-3.422-0.361-4.332-0.76l0.547-3.193l0.501,0.228
                           c1.277,0.532,2.104,0.747,3.661,0.747c1.117,0,2.313-0.438,2.325-1.393c0.007-0.625-0.501-1.07-2.016-1.77
                           c-1.476-0.683-3.43-1.827-3.405-3.876c0.021-2.773,2.729-4.708,6.571-4.708c1.506,0,2.713,0.31,3.483,0.599l-0.526,3.092
                           l-0.351-0.165c-0.716-0.288-1.638-0.566-2.91-0.546c-1.522,0-2.228,0.634-2.228,1.227c-0.008,0.668,0.824,1.108,2.184,1.77
                           C33.126,23.546,34.163,24.783,34.146,26.404z M0,16.962l0.05-0.286h6.028c0.813,0.031,1.468,0.29,1.694,1.159l1.311,6.304
                           C7.795,20.842,4.691,18.099,0,16.962z M17.581,16.812l-6.123,14.239l-4.114,0.007L3.862,19.161
                           c2.503,1.602,4.635,4.144,5.386,5.914l0.406,1.469l3.808-9.729L17.581,16.812L17.581,16.812z M19.153,16.8h3.89L20.61,31.066
                           h-3.888L19.153,16.8z" />
                                </g>
                            </g>
                        </svg>
                    </div>
                    <div class="number"></div>
                    <div class="card-holder">
                        <label>Card holder</label>
                        <div></div>
                    </div>
                    <div class="card-expiration-date">
                        <label>Expires</label>
                        <div></div>
                    </div>
                </div>
                <div class="back">
                    <div class="strip"></div>
                    <div class="logo">
                        <svg version="1.1" id="visa" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                             width="47.834px" height="47.834px" viewBox="0 0 47.834 47.834" style="enable-background:new 0 0 47.834 47.834;">
                            <g>
                                <g>
                                    <path d="M44.688,16.814h-3.004c-0.933,0-1.627,0.254-2.037,1.184l-5.773,13.074h4.083c0,0,0.666-1.758,0.817-2.143
                           c0.447,0,4.414,0.006,4.979,0.006c0.116,0.498,0.474,2.137,0.474,2.137h3.607L44.688,16.814z M39.893,26.01
                           c0.32-0.819,1.549-3.987,1.549-3.987c-0.021,0.039,0.317-0.825,0.518-1.362l0.262,1.23c0,0,0.745,3.406,0.901,4.119H39.893z
                           M34.146,26.404c-0.028,2.963-2.684,4.875-6.771,4.875c-1.743-0.018-3.422-0.361-4.332-0.76l0.547-3.193l0.501,0.228
                           c1.277,0.532,2.104,0.747,3.661,0.747c1.117,0,2.313-0.438,2.325-1.393c0.007-0.625-0.501-1.07-2.016-1.77
                           c-1.476-0.683-3.43-1.827-3.405-3.876c0.021-2.773,2.729-4.708,6.571-4.708c1.506,0,2.713,0.31,3.483,0.599l-0.526,3.092
                           l-0.351-0.165c-0.716-0.288-1.638-0.566-2.91-0.546c-1.522,0-2.228,0.634-2.228,1.227c-0.008,0.668,0.824,1.108,2.184,1.77
                           C33.126,23.546,34.163,24.783,34.146,26.404z M0,16.962l0.05-0.286h6.028c0.813,0.031,1.468,0.29,1.694,1.159l1.311,6.304
                           C7.795,20.842,4.691,18.099,0,16.962z M17.581,16.812l-6.123,14.239l-4.114,0.007L3.862,19.161
                           c2.503,1.602,4.635,4.144,5.386,5.914l0.406,1.469l3.808-9.729L17.581,16.812L17.581,16.812z M19.153,16.8h3.89L20.61,31.066
                           h-3.888L19.153,16.8z" />
                                </g>
                            </g>
                        </svg>

                    </div>
                    <div class="ccv">
                        <label>CCV</label>
                        <div></div>
                    </div>
                </div>
            </div>
        </div>
        <form class="form" asp-controller="VisuallyImpaired" asp-action="CardActivation" method="post" autocomplete="off" novalidate>
            <fieldset>
                <label for="card-number">Card Number (last 8 digits of your card number)</label>
                <input type="num" id="card-number" class="input-cart-number" value="xxxx" readonly />
                <input type="num" id="card-number-0" class="input-cart-number" value="xxxx" readonly />
                <input asp-for="cardNumber1" type="num" id="card-number-1" class="input-cart-number" maxlength="4" placeholder="1234" required />
                <input asp-for="cardNumber2" type="num" id="card-number-2" class="input-cart-number" maxlength="4" placeholder="1234" required />
            </fieldset>

            <fieldset>
                <label for="card-holder">Card holder</label>
                <input type="text" id="card-holder" asp-for="cardHolderName" placeholder="Name on the card" required />
            </fieldset>
            <fieldset class="fieldset-expiration">
                <label for="expirationMonth">Expiration date</label>
                <div class="select">
                    <select id="card-expiration-month" asp-for="expirationMonth">
                        <option>Month</option>
                        <option value="01">01</option>
                        <option value="02">02</option>
                        <option value="03">03</option>
                        <option value="04">04</option>
                        <option value="05">05</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                        <option value="08">08</option>
                        <option value="09">09</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                    </select>
                </div>
                <div class="select">
                    <select id="card-expiration-year" asp-for="expirationYear">
                        <option>Year</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                        <option value="2031">2031</option>
                        <option value="2032">2032</option>
                    </select>
                </div>
            </fieldset>

            <fieldset class="fieldset-ccv">
                <label for="cvv">CCV</label>
                <input asp-for="cvv" type="text" id="card-ccv" maxlength="3" required />
            </fieldset>

            <div id="security-questions-container">
                <!-- Initial security question fieldset -->
                <fieldset class="security-question-fieldset">
                    <div class="security-question-inputs">
                        <div class="select">
                            <select asp-for="securityQuestion" class="security-question-dropdown">
                                <option>Questions</option>
                                <option value="1">Where is your primary school?</option>
                                <option value="2">Who is your best friend?</option>
                                <option value="3">Do you have any musical background?</option>
                            </select>
                        </div>
                        <input asp-for="securityQuestion" type="text" class="security-question" maxlength="20" style="margin-top:10px; border: none; display:none;" placeholder="Questions" required/>
                        <input asp-for="answer" type="text" class="security-answer" maxlength="20" style="margin-top:10px; border: none;" placeholder="Answer" required />
                    </div>
                </fieldset>
                <!-- Add button -->
                @* <button class="btn-add-question"><i class="fas fa-plus"></i>Add more questions</button> *@
            </div>
            @if (ViewData["CardActivation"] != null)
            {
                <span class="form-control-plaintext text-danger">@ViewData["CardActivation"]</span>
            }
            <button class="btn"><i class="fa fa-lock"></i> submit</button>
        </form>
    </div>
    }
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    @*    <script src="script.js"></script>*@

    <script>

        
        //$(document).ready(function () {
        //  /*  var maxQuestions = 3;*/ // Set the maximum number of additional questions

        //    $('#security-questions-container').on('click', '.security-question', function (e) {
        //        e.preventDefault();

        //        // Check if the maximum number of questions is reached
        //        //if ($('#security-questions-container .security-question-fieldset').length >= maxQuestions) {
        //        //    alert('You can add a maximum of ' + maxQuestions + ' extra questions.');
        //        //    return;
        //        //}

        //        var newSecurityQuestionFieldset = $('.security-question-fieldset:first').clone();

        //        // Clear the selected option and input value
        //        newSecurityQuestionFieldset.find('.security-question-dropdown').val('Questions');
        //        newSecurityQuestionFieldset.find('.security-answer').val('');

        //        // Insert the new question and answer fieldset before the "Add" button
        //        $(this).before(newSecurityQuestionFieldset);
        //    });
        //});
        // Add an event listener to the select dropdown
        // Get references to the select element and the input field for custom questions

        $('.input-cart-number').on('keyup change', function () {
            $t = $(this);

            if ($t.val().length > 3) {
                $t.next().focus();
            }

            var card_number = '';
            $('.input-cart-number').each(function (index) {
                if (index < 2) {
                    card_number += 'xxxx ';
                } else {
                    card_number += $(this).val() + ' ';
                    if ($(this).val().length == 4) {
                        $(this).next().focus();
                    }
                }
            })

            $('.credit-card-box .number').html(card_number);
        });

        $('#card-holder').on('keyup change', function () {
            $t = $(this);
            $('.credit-card-box .card-holder div').html($t.val());
        });

        $('#card-expiration-month, #card-expiration-year').change(function () {
            m = $('#card-expiration-month option').index($('#card-expiration-month option:selected'));
            m = (m < 10) ? '0' + m : m;
            y = $('#card-expiration-year').val().substr(2, 2);
            $('.card-expiration-date div').html(m + '/' + y);
        })

        $('#card-ccv').on('focus', function () {
            $('.credit-card-box').addClass('hover');
        }).on('blur', function () {
            $('.credit-card-box').removeClass('hover');
        }).on('keyup change', function () {
            $('.ccv div').html($(this).val());
        });

        setTimeout(function () {
            $('#card-number-1').focus();
        }, 500);

        

        const ActivationMsg = document.getElementById('CardActivationMsg').innerHTML;

        if (ActivationMsg == "Card Activated Successfully") {
            if (sessionStorage.getItem("annyangStatus" == "true"){
                speakResponse("Card activated successfully.")
            }
        }
        else if (ActivationMsg == "Card Activation Failed") {
            if (sessionStorage.getItem("annyangStatus" == "true"){
                speakResponse("Card activation failed.")
            }
        }

        $(document).ready(function () {
            $('#card-expiration-month').change(function () {
                var selectedMonth = $(this).val();
                $('#selected-month').val(selectedMonth);
            });
        });

    </script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/annyang-setup.js" asp-append-version="true"></script>
    <script src="~/js/search.js" asp-append-version="true"></script>

</body>
</html>