@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html>
<head>
    <!-- Use Unicode character encoding - multi-language compatibility -->
    <meta charset="utf-8">

    <!-- Set the initial view zooming scale for mobile device -->
    <meta name="viewport" content="width = device-width,initial-scale = 1"/>

    <title>OCBC Homepage</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <link rel="stylesheet" type="text/css" href="~/css/homepage.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.6.0/annyang.min.js"></script>


    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Bootstrap JavaScript (Popper.js is required for dropdowns) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    @{
        // Check if Context and Session are not null
        var fontSize = Context?.Session?.GetInt32("FontSize") ?? 20;
    }

    <style>
        body {
            font-size: @(fontSize)px;
        }
    </style>
</head>
<body>
    <style>
        .center-div {
            display: none;
            position: fixed;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            color: #333;
            max-height: 70vh;
            max-width: 80vw;
            overflow-y: auto;
        }
    </style>

    <!-- Add an overlay div -->
    <div id="overlay"></div>

    <!-- Center div -->
    <div id="centerDiv" class="center-div enlarged-text" role="dialog" aria-labelledby="accessibilityMode" aria-describedby="tutorialContent">
        <span class="close" onclick="closeCenterDiv()">&times;</span>
        <h1 id="accessibilityMode" style="font-size: 1.6em">Accessibility Mode</h1>
        <div id="tutorialContent" style="font-size: 1.6em" aria-live="assertive">

        </div>
        <div class="buttons">
            <button  type="button" class="btn btn-secondary" id="cancelButton">Cancel</button>
            <button  type="button" class="btn btn-primary" id="skipButton">Skip</button>
            <button  type="button" class="btn btn-success" id="nextButton">Next</button>
        </div>
    </div>

    <header>
        <partial name="Navbar"/>
    </header>

    <div class="imagetext">
        <div class="blur">
            <img src="~/img/home_img.jpg" alt="Image" />
            <div class="text"><b>Welcome to OCBC</b></div>
        </div>
    </div>
    <fieldset class="FormContent">
        <legend></legend>
        <div class="flex">
            <div class="flex-column">
                <p><b>Banking for Individual</b></p>
                <li class="flex-item"><a href="#">FRANK by OCBC</a></li>
                <li class="flex-item"><a href="#">Personal Banking</a></li>
                <li class="flex-item"><a href="#">Premier Banking</a></li>
                <li class="flex-item"><a href="#">Premier Private Client</a></li>
            </div>
            <div class="flex-column">
                <p><b>Banking for Businesses</b></p>
                <li class="flex-item"><a href="#">Business Banking</a></li>
                <li class="flex-item"><a href="#">Large Corporates</a></li>
            </div>
            <div class="flex-column">
                <p><b>OCBC Group</b></p>
                <li class="flex-item"><a href="#">About us</a></li>
                <li class="flex-item"><a href="#">Sustainability</a></li>
                <li class="flex-item"><a href="#">Careers</a></li>
                <li class="flex-item"><a href="#">Investors</a></li>
            </div>
        </div>
    </fieldset>



    <script>
    var activateCount = localStorage.getItem("activateCount");
    document.addEventListener("DOMContentLoaded", function () {
        // Check if the modal should be shown
        var shouldShowModal = sessionStorage.getItem("showModal");

        if (!shouldShowModal) {
            openCenterDiv();
            // Set the flag to indicate that the modal has been shown
            sessionStorage.setItem("showModal", "true");
        }
        document.getElementById('accessibilityMode').focus();

        var storedStatus = sessionStorage.getItem("annyangStatus");

        activateCount = 0;

        document.getElementById('skipButton').style.display = 'none';
    });

    // Variable to keep track of the current tutorial step
    var currentStep = 1;

    // Function to update tutorial content for different steps
        function updateTutorialContent() {
            var tutorialContent = document.getElementById("tutorialContent");

            // Check the current step and update content accordingly
            switch (currentStep) {
                case 1:
                    tutorialContent.innerHTML = `<p>Do you know how to use our voice recognition?</p>`;
                    cancelButton.textContent = "Yes";
                    nextButton.textContent = "No";
                    cancelButton.removeEventListener('click', previousTutorialStep);
                    cancelButton.addEventListener('click', close);   //before activation we have cancel button
                    break;
                case 2:
                    tutorialContent.innerHTML = `<p>Tutorial Step 1: Hold Control key to activate voice recognition, 
                    say 'Next' and release control key to go to next step.</p>`;
                    cancelButton.textContent = "Previous";
                    nextButton.textContent = "Next";
                    cancelButton.removeEventListener('click', close);
                    cancelButton.addEventListener('click', previousTutorialStep); //in tutorial we only have previous button
                    break;


                case 3:
                    tutorialContent.innerHTML = `<p>Step 2: Say "Search" to focus on search bar. And say 'Type In' followed by your input to enter your information verbally.
                             After that, press enter on keyboard. Try it out in next page.</p>
                              `;
                    cancelButton.textContent = "Previous";
                    nextButton.textContent = "Next";
                    cancelButton.removeEventListener('click', close);
                    cancelButton.addEventListener('click', previousTutorialStep);
                    break;
                case 4:
                    tutorialContent.innerHTML = `<div class="search-wrapper">
                                    <i class="search-icon bx bx-search"></i>
                                    <input type="search" id="searchDemo" data-search placeholder="Search">
                                </div>
                              `;
                    document.getElementById("tutsearch").style.display = "block";
                    cancelButton.textContent = "Previous";
                    nextButton.textContent = "Next";
                    cancelButton.removeEventListener('click', close);
                    cancelButton.addEventListener('click', previousTutorialStep);
                    break;
                case 5:
                    tutorialContent.innerHTML = `<p>Step 4: To navigate to different pages, use voice commands starting with 'Go to.'
                            For example, 'Go to login page'. The system also may provide suggestion for you based on your inacurate voice command.</p>`;
                    cancelButton.textContent = "Previous";
                    nextButton.textContent = "Close";
                    cancelButton.removeEventListener('click', close);
                    cancelButton.addEventListener('click', previousTutorialStep);
                    break;
            }
        }

    function openCenterDiv() {
        var overlay = document.getElementById("overlay");
        var centerDiv = document.getElementById("centerDiv");
        if (overlay && centerDiv) {
            overlay.style.display = "block";
            centerDiv.style.display = "block";
            document.body.style.overflow = "hidden"; // Disable scrolling
            updateTutorialContent(); // Update content when opening the modal
        }
    }

    function closeCenterDiv() {
        var overlay = document.getElementById("overlay");
        var centerDiv = document.getElementById("centerDiv");
        if (overlay && centerDiv) {
            overlay.style.display = "none";
            centerDiv.style.display = "none";
            document.body.style.overflow = ""; // Enable scrolling
        }
    }

    function nextTutorialStep() {
        // Increment the current step
        currentStep++;
        if (currentStep === 6) {
            close();
        }

        // Update the tutorial content for the new step
        updateTutorialContent();
        updateFontSizeBasedOnEnlargedText();
    }

    function previousTutorialStep() {
        // Decrement the current step
        currentStep--;

        if (currentStep === 0) {
            close();
        }

        // Update the tutorial content for the new step
        updateTutorialContent();
    }

    function updateFontSizeBasedOnEnlargedText() {
        const tutorialContentElement = document.getElementById('tutorialContent');
        const isEnlargedPage = document.body.classList.contains('enlarged-page');
        const isEnlargedText = document.body.classList.contains('enlarged-text');

        if (tutorialContentElement && isEnlargedPage && isEnlargedText) {
            tutorialContentElement.style.fontSize = '1.2em';
        }
    }

    function updateFontSize(size) {
        $.ajax({
            url: '/Home/UpdateFontSizeJS',
            type: 'POST',
            data: { size: size },
            success: function (data) {
                // Optionally handle the response from the server
                console.log('Font size updated successfully');
            },
            error: function (error) {
                console.error('Error updating font size:', error);
            }
        });
    }

    document.getElementById('cancelButton').addEventListener('click', close);

    function activateAccessibility() {
        // code for activating accessibility
        if (!annyang.isListening()) {
            startListening();
            activateCount++;
            sessionStorage.setItem("activateCount", activateCount);
            toggleEnlargedPage();
            updateFontSize(25); //update the font size in context
            document.body.style.fontSize = "25px";
        }
    }



    function close() {
        // code for canceling activation
        closeCenterDiv();
        documentgetElementById('centerDiv').style.display = 'none';
    }

    // Add another event listener to the "Activate" button for the second action (proceed to the next step)
    document.getElementById('nextButton').addEventListener('click', function () {
        if (currentStep === 1) {
            activateAccessibility();
            document.getElementById('skipButton').style.display = "block";
            nextTutorialStep();
        } else if (currentStep === 2 && activateCount >= 2) {
            nextTutorialStep();
        }
        else if (currentStep === 2 && activateCount < 2){
            speakResponse("Please toggle the accessibility mode using control + space.");
        }
        else if (currentStep === 3) {
            nextTutorialStep()

        }
        else if (currentStep === 4) {
            const searchDemoValue = document.getElementById('searchDemo').value.trim();
            if (searchDemoValue !== '') {
                nextTutorialStep();
            }
            else {
                speakResponse("Please enter something into search bar.");
            }
        }
        else if (currentStep === 5) {
            nextTutorialStep();
        }
    });

    document.getElementById('skipButton').addEventListener('click', close);

    document.addEventListener("keydown", function (event) {
        // Check if centerDiv exists
        var centralDiv = document.getElementById("centerDiv");
        if (!centerDiv) {
            return;
        }

        if (event.key === "N" && event.shiftKey && document.activeElement.tagName !== "INPUT") {
            if (currentStep === 1) {
                activateAccessibility();
                nextTutorialStep();
                document.getElementById("skipButton").style.display = "block";
            } else if (currentStep === 2 && activateCount >= 2) {
                nextTutorialStep();
            }
            else if (currentStep === 2 && activateCount < 2) {
                speakResponse("Please toggle the accessibility mode using control + space.");
            }
            else if (currentStep === 3) {
                    const searchDemoInput = document.getElementById('searchDemo');
                    const searchDemoValue = searchDemoInput.value.trim();

                    searchDemoInput.addEventListener('keydown', function (event) {
                        if (event.key === 'Enter') {
                            if (document.activeElement === searchDemoInput && searchDemoValue !== '') {
                                nextTutorialStep();
                            } else {
                                speakResponse("Please enter something into the search bar.");
                            }
                        }
                    });

                    if (searchDemoValue !== '') {
                        nextTutorialStep();
                    } else {
                        speakResponse("Please enter something into the search bar.");
                    }
            }
            else if (currentStep === 4) {
                nextTutorialStep();
            }
            else if (currentStep === 5) {
                nextTutorialStep();
            }
        }
        else if (event.key === "B" && event.shiftKey && document.activeElement.tagName !== "INPUT") {
            previousTutorialStep();
        }


        if ((event.ctrlKey || event.metaKey) && event.key === " " && document.activeElement.tagName !== "INPUT") {
            if (!annyang.isListening()) {
                activateCount++;
            }
        }
    });
    </script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/annyang-setup.js" asp-append-version="true"></script>
</body>
</html>